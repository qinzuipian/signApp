<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>首页</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/common.css" />
		<link rel="stylesheet" type="text/css" href="../css/swiper.css" />
		<link rel="stylesheet" type="text/css" href="css/index1.css" />
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav header-relative header-blue">
			<!-- <div id="toCity">
				<span class="mui-text-left choosecity" id="city-name">西安市</span>
				<i class="mui-icon mui-icon-arrowdown" style="font-size: 18px;margin-left: -13px;"></i>
			</div> -->
			<p class="header-title">首页</p>
		</header>
		<div id="app" style="margin-top: 0;">
			<div class="swiper-container">
				<div class="swiper-wrapper">
					<div class="swiper-slide">
						<img class="bannerimg" src="../img/lunbotu1.jpg" />
					</div>
					<div class="swiper-slide">
						<img class="bannerimg" src="../img/lunbotu2.jpg" />
					</div>
					<div class="swiper-slide">
						<img class="bannerimg" src="../img/lunbotu3.jpg" />
					</div>
				</div>
				<!-- 如果需要分页器 -->
				<div class="swiper-pagination"></div>
			</div>
			<div class="service flex">
				<li class="service-item" id="appointment">
					<img src="../img/index/hang.jpg">
					<p>预约</p>
				</li>
				<li class="service-item" id="hospital">
					<img src="../img/index/key.jpg">
					<p>履约</p>
				</li>
				<li class="service-item" id="insurance">
					<img src="../img/index/suifang.jpg">
					<p>随访</p>
				</li>
				<li class="service-item" id="bodycheck">
					<img src="../img/index/pingjia.jpg">
					<p>评价</p>
				</li>

				<!-- <li class="service-item" id="push">
					<img src="../img/index/baoxian.png">
					<p>push</p>
				</li> -->
			</div>

			<div id="signMain" style="display: none;">
				<div class="sign flex">
					<div class="sign-logo">
						<img src="../img/index/yisheng.jpg">
					</div>
					<div class="sign-box">
						<p>我的家庭医生</p>
						<p>为家庭健康保驾护航</p>
						<button type="button" class="mui-btn mui-btn-primary mui-btn-outlined" onclick="signing()">立即签约</button>
						<button type="button" class="mui-btn mui-btn-primary mui-btn-outlined" onclick="sweepCode()">扫码签约</button>
					</div>
				</div>
			</div>

			<div class="shop">
				<div class="flex">
					<p class="shop-title">寻健康<span>小生活大健康</span></p>
					<p class="mui-icon mui-icon-arrowright more-shop"></p>
				</div>

				<div class="flex">
					<div class="left">
						<img src="../img/index/zhongyiyangsheng.jpg">
					</div>
					<div class="right">
						<div>
							<img src="../img/index/fuyoubaojian.jpg">
						</div>
						<div>
							<img src="../img/index/ajiao.jpg">
						</div>
					</div>
				</div>
			</div>

			<!-- <div class="news">
				<div class="flex">
					<p class="shop-title">健康新闻</p>
					<p class="mui-icon mui-icon-arrowright more-shop"></p>
				</div>
				<ul class="mui-table-view">
					<li class="mui-table-view-cell mui-media flex">
						<div class="news-pic">
							<img src="../img/index/hashiqi.jpg">
						</div>
						<div class="news-title">
							<p>时间睡眠日,睡眠君、我该如何拯救你？</p>
							<p>2019-10-10</p>
						</div>
					</li>

					<li class="mui-table-view-cell mui-media flex">
						<div class="news-pic">
							<img src="../img/index/hashiqi.jpg">
						</div>
						<div class="news-title">
							<p>时间睡眠日,睡眠君、我该如何拯救你？</p>
							<p>2019-10-10</p>
						</div>
					</li>

					<li class="mui-table-view-cell mui-media flex">
						<div class="news-pic">
							<img src="../img/index/hashiqi.jpg">
						</div>
						<div class="news-title">
							<p>时间睡眠日,睡眠君、我该如何拯救你？</p>
							<p>2019-10-10</p>
						</div>
					</li>

					<li class="mui-table-view-cell mui-media flex">
						<div class="news-pic">
							<img src="../img/index/hashiqi.jpg">
						</div>
						<div class="news-title">
							<p>时间睡眠日,睡眠君、我该如何拯救你？</p>
							<p>2019-10-10</p>
						</div>
					</li>

					<li class="mui-table-view-cell mui-media flex">
						<div class="news-pic">
							<img src="../img/index/hashiqi.jpg">
						</div>
						<div class="news-title">
							<p>时间睡眠日,睡眠君、我该如何拯救你？</p>
							<p>2019-10-10</p>
						</div>
					</li>
				</ul>
			</div> -->

		</div>
		<script src="../js/mui.js"></script>
		<script src="../js/common.js"></script>
		<script src="../js/swiper.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.init({

				pullRefresh: {
					container: "#app", //下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
					down: {
						style: 'circle', //必选，下拉刷新样式，目前支持原生5+ ‘circle’ 样式
						color: '#2BD009', //可选，默认“#2BD009” 下拉刷新控件颜色
						height: '50px', //可选,默认50px.下拉刷新控件的高度,
						range: '100px', //可选 默认100px,控件可下拉拖拽的范围
						offset: '0px', //可选 默认0px,下拉刷新控件的起始位置
						auto: false, //可选,默认false.首次加载自动上拉刷新一次
						callback: function() { //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
							var ws = plus.webview.currentWebview();
							ws.reload();
							mui('#app').pullRefresh().endPulldownToRefresh(false);
						}
					}
				}

			});
			// 			function pullRefreshFunc(){
			// 				console.log(111);
			// 			}
			var sign = document.getElementById("sign"); // 免费签约
			// var toCity = document.getElementById("toCity"); // 选择城市
			var cityName = document.getElementById("city-name"); //城市名字 

			mui.plusReady(function() {
				// 轮播图的定时器
				sblider();
				// common.js 获取本地数据
				getStorageDate();
				indexPageInit();
				//调用父页面的函数
				plus.webview.currentWebview().opener().evalJS("indexInit()");
			})
			// 轮播图
			function sblider() {
				setTimeout(function() {
					// 初始化swiper
					var mySwiper = new Swiper('.swiper-container', {
						direction: 'horizontal', // 垂直切换选项
						loop: true, // 循环模式选项
						autoplay: {
							delay: 3000, //3秒切换一次
							disableOnInteraction: false,
						},
						// 如果需要分页器
						pagination: {
							el: '.swiper-pagination',
						},
					})
				}, 100)
			}

			// 四大功能 appointment   hospital   insurance    bodycheck
			var appointment = document.getElementById("appointment"),
				hospital = document.getElementById("hospital"),
				insurance = document.getElementById("insurance"),
				bodycheck = document.getElementById("bodycheck"),
				signMain = document.getElementById("signMain");
			// push = document.getElementById("push");

			appointment.addEventListener("tap", function() {
				// plus.nativeUI.toast("暂未开放此功能")
				if(mui.os.plus) {
					var buttonTit = [{
						title: "医生预约"
					}, {
						title: "接种疫苗预约"
					}];

					plus.nativeUI.actionSheet({
						//					title: "上传图片",
						cancel: "取消",
						buttons: buttonTit
					}, function(b) { /*actionSheet 按钮点击事件*/
						switch(b.index) {
							case 0:
								break;
							case 1:
								getAppointment(1);
								break;
							case 2:
								getAppointment(2);
								break;
							default:
								break;
						}
					})
				}
				/* var appoDoctor = plus.webview.create("./index1/appoDoctor.html", appoDoctor);
				plus.webview.show(appoDoctor, "slide-in-right", 300) */

				// 				var self = plus.webview.currentWebview(),
				// 					childWV = null,
				// 					targetUrl = "http://qdwz.sx.witdoctor.cn/Register/hosList?um=JKSX_WX";
				// 				childWV = plus.webview.create(targetUrl, 'baiduMap', {
				// 					top: '64px',
				// 					bottom: 0
				// 				});
				// 				self.append(childWV);
				// 				childWV.show('slide-in-bottom');
			}, {
				passive: false
			});

			function getAppointment(type) {
				if(userStatus == 0) {
					plus.nativeUI.toast("检测到尚未登录,请登录之后查看")
				} else if(userStatus == 1) {
					plus.nativeUI.toast("检测到尚未认证,请绑定身份证")
				} else {
					var appoDoctor = plus.webview.create("./index1/appoDoctor.html", 'appoDoctor', {}, {
						appType: type
					});
					plus.webview.show(appoDoctor, "slide-in-right", 300)
				}

			}
			//履约
			hospital.addEventListener("tap", function() {
				// plus.nativeUI.toast("暂未开放此功能")
				if(userStatus == 0) {
					plus.nativeUI.toast("检测到尚未登录,请登录之后查看")
				} else if(userStatus == 1) {
					plus.nativeUI.toast("检测到尚未认证,请绑定身份证")
				} else {
					var performanceRecord = plus.webview.create("set/performanceRecord.html", 'p_record');
					plus.webview.show(performanceRecord, "slide-in-right", 300)
				}

			}, {
				passive: false
			});
			insurance.addEventListener("tap", function() {
				// plus.nativeUI.toast("暂未开放此功能")	
				if(userStatus == 0) {
					plus.nativeUI.toast("检测到尚未登录,请登录之后查看")
				} else if(userStatus == 1) {
					plus.nativeUI.toast("检测到尚未认证,请绑定身份证")
				} else {
					var accompany = plus.webview.create("./index1/accompanyindex.html", 'accompany');
					plus.webview.show(accompany, "slide-in-right", 300)
				}

			}, {
				passive: false
			});
			//评价
			bodycheck.addEventListener("tap", function() {
				// plus.nativeUI.toast("暂未开放此功能")
				if(userStatus == 0) {
					plus.nativeUI.toast("检测到尚未登录,请登录之后查看")
				} else if(userStatus == 1) {
					plus.nativeUI.toast("检测到尚未认证,请绑定身份证")
				} else {
					var allSuggest = plus.webview.create("set/allSuggest.html", 'allSuggest');
					plus.webview.show(allSuggest, "slide-in-right", 300)
				}

			}, {
				passive: false
			});

			// 选择城市
			// 			toCity.addEventListener("tap", function() {
			// 				var city = plus.webview.create("./index1/selectCity.html", "city");
			// 				plus.webview.show(city,"slide-in-right", 200);
			// 			}, {
			// 				passive: false
			// 			})

			// 监听从选择城市页面传来的值
			document.addEventListener("selectCity", function(e) {
				// console.log(JSON.stringify(e.detail.name));
				cityName.innerHTML = e.detail.name
			}, {
				passive: false
			})

			// 签约
			function signing() {
				// var userStatus = plus.storage.getItem("userStatus");
				if(userStatus == "0") {
					var login = plus.webview.create("./login/login.html", "login");
					plus.webview.show(login, "slide-in-right", 300);
				} else if(userStatus == "1") {
					var bindIdCard = plus.webview.create("./login/bindIdCard.html", "bindIdCard");
					plus.webview.show(bindIdCard, "slide-in-right", 300);
				} else {
					var teamList = plus.webview.create("./index1/teamList.html", "teamList");
					plus.webview.show(teamList, "slide-in-right", 300);
				}
			}

			window.addEventListener("refresh", function() {
				console.log("index_刷新了一下");
				getStorageDate();
				indexPageInit();
			}, {
				passive: false
			})

			function indexPageInit() {
				console.log(userStatus);
				var isContrct = plus.storage.getItem("isContrct");
				console.log(isContrct)
				if(isContrct == 0) {
					signMain.style.display = "block"
				} else {
					signMain.style.display = "none"
				}
			};

			function sweepCode() {
				var sweepCode = plus.webview.create("./index1/sweepCode.html", "sweepCode");
				plus.webview.show(sweepCode, "slide-in-right", 300);
			}
		</script>
	</body>

</html>